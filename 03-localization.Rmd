# Localization Methods  

## Primitive: Weighted Average  

This is simply a weighted average based on number of beeps on a node and max. RSSI values. It takes the following mandatory arguments:  
* freq: this is the interval a localization should be summarized over, and is in the form of an interval (e.g. "3 min")  
* beep_data: raw beep data frame (e.g. all_data[[1]][[1]] from example.R)  
* node: read in node file  

locations <- weighted_average(freq = "3 min", beep_data, node = nodes, node_health, 0, tags)  

## Triangulation Functions  

### Data Prep  

This function prepares beep data to be input into the triangulation.    

```{r eval=FALSE}
input <- loc_prep(beep_data, nodes, freq)  
```
### Calibration  

This function preps the beep data frame for input into the triangulation function, and also implements a calibration by fitting an asymptotic function for RSSI and distance. 

The calibration data frame needs the following column names:  
* pt: this can be any identifier for a given location used in the calibration  
* session_id: this can be any identifier for the time period the tag was at this spot  
* start: the beginning of the time interval when the tag was placed at the point, in POSIXct UTC  
* end: the end of the time interval when the tag was placed at the point, in POSIXct UTC  
* TagId: the tag ID left at the point  
* TagLat: latitude of the point  
* TagLng: longitude of the point  

The option `calibrate = TRUE` is the default, and means that summary stats will be calculated over the entire time interval for each calibration location. Otherwise, pass `calibrate = FALSE, freq = <interval>` for the time interval of interest.
```{r eval=FALSE}
calibrated <- calibrate(beep_data, calibration, nodes, calibrate = TRUE)
```
This function returns a list, the items of which are...  
1. data frame to be input into the triangulation  
2. a (see below)  
3. S (see below)  
4. K (see below)  

### Custom Distance Function  

You can pass a custom distance function, in the form of a string, that represents the relationship between RSSI and distance for your system. The string is the right side of the formula, where the left side is distance. The string needs to contain `x` which refers to RSSI. An example of an asymptotic relationship can be generated by the following function and the output of the calibrate function:
```{r eval=FALSE}
relation <- relate(calibrated[[2]], calibrated[[3]], calibrated[[4]])
```
### Triangulation

This performs the triangulation with an input dataframe and defined distance relationship.  
```{r eval=FALSE}
out <- triangulate(calibrated[[1]], distance = relation)
```
