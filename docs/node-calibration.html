<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Node Calibration | ‘celltracktech’ Data Analysis package</title>
  <meta name="description" content="This is a manual for the R package ‘celltracktech’" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Node Calibration | ‘celltracktech’ Data Analysis package" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a manual for the R package ‘celltracktech’" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Node Calibration | ‘celltracktech’ Data Analysis package" />
  
  <meta name="twitter:description" content="This is a manual for the R package ‘celltracktech’" />
  

<meta name="author" content="Jessica Gorzo" />


<meta name="date" content="2025-05-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="CTT-FB-logo-STACKED.jpg" type="image/x-icon" />
<link rel="prev" href="node-check.html"/>
<link rel="next" href="presenceabsence-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CTT Data Tools</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> AOS2024 - ‘celltracktech’ Workshop</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#additional-libraries-needed-linux-users"><i class="fa fa-check"></i><b>1.1</b> Additional Libraries Needed (Linux users)</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#install-postgresql-libraries"><i class="fa fa-check"></i><b>1.1.1</b> Install PostgreSQL libraries</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#installing-r-spatial-on-ubuntu"><i class="fa fa-check"></i><b>1.1.2</b> Installing R Spatial on Ubuntu</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="project-setup.html"><a href="project-setup.html"><i class="fa fa-check"></i><b>2</b> Project Setup</a>
<ul>
<li class="chapter" data-level="2.1" data-path="project-setup.html"><a href="project-setup.html#create-an-r-studio-project"><i class="fa fa-check"></i><b>2.1</b> Create an R Studio Project</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="project-setup.html"><a href="project-setup.html#git"><i class="fa fa-check"></i><b>2.1.1</b> Git</a></li>
<li class="chapter" data-level="2.1.2" data-path="project-setup.html"><a href="project-setup.html#renv"><i class="fa fa-check"></i><b>2.1.2</b> <code>renv</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="project-setup.html"><a href="project-setup.html#request-an-api-token"><i class="fa fa-check"></i><b>2.2</b> Request an API token</a></li>
<li class="chapter" data-level="2.3" data-path="project-setup.html"><a href="project-setup.html#create-a-.env-file"><i class="fa fa-check"></i><b>2.3</b> Create a ‘.env’ file</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="project-setup.html"><a href="project-setup.html#load-the-api-key-into-your-rstudio-environment"><i class="fa fa-check"></i><b>2.3.1</b> Load the API key into your RStudio environment</a></li>
<li class="chapter" data-level="2.3.2" data-path="project-setup.html"><a href="project-setup.html#add-.env-file-to-.gitignore"><i class="fa fa-check"></i><b>2.3.2</b> Add .env file to .gitignore</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="project-setup.html"><a href="project-setup.html#organize-your-project-directory"><i class="fa fa-check"></i><b>2.4</b> Organize your Project Directory</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="download-data.html"><a href="download-data.html"><i class="fa fa-check"></i><b>3</b> Download Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="download-data.html"><a href="download-data.html#create-a-duckdb-database"><i class="fa fa-check"></i><b>3.1</b> Create a DuckDB database</a></li>
<li class="chapter" data-level="3.2" data-path="download-data.html"><a href="download-data.html#download-data-from-the-ctt-api"><i class="fa fa-check"></i><b>3.2</b> Download data from the CTT API</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="download-data.html"><a href="download-data.html#create-database-from-files-on-your-computer"><i class="fa fa-check"></i><b>3.2.1</b> Create Database from Files on your Computer</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="download-data.html"><a href="download-data.html#updating-the-database"><i class="fa fa-check"></i><b>3.3</b> Updating the database</a></li>
<li class="chapter" data-level="3.4" data-path="download-data.html"><a href="download-data.html#disconnecting-from-the-database"><i class="fa fa-check"></i><b>3.4</b> Disconnecting from the database</a></li>
<li class="chapter" data-level="3.5" data-path="download-data.html"><a href="download-data.html#uploading-node-data-from-the-sd-card"><i class="fa fa-check"></i><b>3.5</b> Uploading Node Data from the SD Card</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="download-data.html"><a href="download-data.html#create-nodes-directory"><i class="fa fa-check"></i><b>3.5.1</b> Create Nodes directory</a></li>
<li class="chapter" data-level="3.5.2" data-path="download-data.html"><a href="download-data.html#create-individual-directories-for-each-node"><i class="fa fa-check"></i><b>3.5.2</b> Create individual directories for each Node</a></li>
<li class="chapter" data-level="3.5.3" data-path="download-data.html"><a href="download-data.html#upload-node-data-to-your-duckdb-database"><i class="fa fa-check"></i><b>3.5.3</b> Upload Node data to your DuckDB database</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="download-data.html"><a href="download-data.html#create-postgres-database"><i class="fa fa-check"></i><b>3.6</b> Create Postgres Database</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="obtaining-data-from-database.html"><a href="obtaining-data-from-database.html"><i class="fa fa-check"></i><b>4</b> Obtaining Data from Database</a>
<ul>
<li class="chapter" data-level="4.1" data-path="obtaining-data-from-database.html"><a href="obtaining-data-from-database.html#duckplyr"><i class="fa fa-check"></i><b>4.1</b> Duckplyr</a></li>
<li class="chapter" data-level="4.2" data-path="obtaining-data-from-database.html"><a href="obtaining-data-from-database.html#sql-queries"><i class="fa fa-check"></i><b>4.2</b> SQL Queries</a></li>
<li class="chapter" data-level="4.3" data-path="obtaining-data-from-database.html"><a href="obtaining-data-from-database.html#list-tables"><i class="fa fa-check"></i><b>4.3</b> List Tables</a></li>
<li class="chapter" data-level="4.4" data-path="obtaining-data-from-database.html"><a href="obtaining-data-from-database.html#find-unique-tags-in-raw-table"><i class="fa fa-check"></i><b>4.4</b> Find unique tags in <code>raw</code> table</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="node-check.html"><a href="node-check.html"><i class="fa fa-check"></i><b>5</b> Node Check</a>
<ul>
<li class="chapter" data-level="5.1" data-path="node-check.html"><a href="node-check.html#node-health"><i class="fa fa-check"></i><b>5.1</b> Node Health</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="node-check.html"><a href="node-check.html#node-health---check-health-records"><i class="fa fa-check"></i><b>5.1.1</b> Node Health - Check Health Records</a></li>
<li class="chapter" data-level="5.1.2" data-path="node-check.html"><a href="node-check.html#battery-and-solar-levels"><i class="fa fa-check"></i><b>5.1.2</b> Battery and Solar Levels</a></li>
<li class="chapter" data-level="5.1.3" data-path="node-check.html"><a href="node-check.html#check-gps"><i class="fa fa-check"></i><b>5.1.3</b> Check GPS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="node-calibration.html"><a href="node-calibration.html"><i class="fa fa-check"></i><b>6</b> Node Calibration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="node-calibration.html"><a href="node-calibration.html#load-sidekick-data-file"><i class="fa fa-check"></i><b>6.1</b> Load sidekick data file</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="node-calibration.html"><a href="node-calibration.html#if-you-do-not-have-a-sidekick-data-file"><i class="fa fa-check"></i><b>6.1.1</b> IF YOU DO NOT HAVE A SIDEKICK DATA FILE:</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="node-calibration.html"><a href="node-calibration.html#setup"><i class="fa fa-check"></i><b>6.2</b> Setup</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="node-calibration.html"><a href="node-calibration.html#load-environmental-variables-into-rstudio"><i class="fa fa-check"></i><b>6.2.1</b> Load environmental variables into RStudio</a></li>
<li class="chapter" data-level="6.2.2" data-path="node-calibration.html"><a href="node-calibration.html#load-settings"><i class="fa fa-check"></i><b>6.2.2</b> Load settings</a></li>
<li class="chapter" data-level="6.2.3" data-path="node-calibration.html"><a href="node-calibration.html#load-node-health-data-from-files"><i class="fa fa-check"></i><b>6.2.3</b> Load Node Health Data from Files</a></li>
<li class="chapter" data-level="6.2.4" data-path="node-calibration.html"><a href="node-calibration.html#get-node-locations"><i class="fa fa-check"></i><b>6.2.4</b> Get Node Locations</a></li>
<li class="chapter" data-level="6.2.5" data-path="node-calibration.html"><a href="node-calibration.html#load-station-detection-from-files"><i class="fa fa-check"></i><b>6.2.5</b> Load Station Detection from Files</a></li>
<li class="chapter" data-level="6.2.6" data-path="node-calibration.html"><a href="node-calibration.html#load-sidekick-calibration-data"><i class="fa fa-check"></i><b>6.2.6</b> Load Sidekick Calibration Data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="node-calibration.html"><a href="node-calibration.html#calculate-the-rssi-vs.-distance-relationship"><i class="fa fa-check"></i><b>6.3</b> Calculate the RSSI vs. Distance Relationship</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="presenceabsence-analysis.html"><a href="presenceabsence-analysis.html"><i class="fa fa-check"></i><b>7</b> Presence/Absence Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="presenceabsence-analysis.html"><a href="presenceabsence-analysis.html#set-parameters"><i class="fa fa-check"></i><b>7.1</b> Set parameters</a></li>
<li class="chapter" data-level="7.2" data-path="presenceabsence-analysis.html"><a href="presenceabsence-analysis.html#load-data-from-database-1"><i class="fa fa-check"></i><b>7.2</b> Load data from database</a></li>
<li class="chapter" data-level="7.3" data-path="presenceabsence-analysis.html"><a href="presenceabsence-analysis.html#load-tag-deployment-info"><i class="fa fa-check"></i><b>7.3</b> Load Tag Deployment Info</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="presenceabsence-analysis.html"><a href="presenceabsence-analysis.html#load-tag-deployment-file"><i class="fa fa-check"></i><b>7.3.1</b> Load Tag Deployment File</a></li>
<li class="chapter" data-level="7.3.2" data-path="presenceabsence-analysis.html"><a href="presenceabsence-analysis.html#get-list-of-detected-tags"><i class="fa fa-check"></i><b>7.3.2</b> Get List of Detected Tags</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="presenceabsence-analysis.html"><a href="presenceabsence-analysis.html#generate-detection-summary"><i class="fa fa-check"></i><b>7.4</b> Generate Detection Summary</a></li>
<li class="chapter" data-level="7.5" data-path="presenceabsence-analysis.html"><a href="presenceabsence-analysis.html#show-detection-history-for-a-specific-tag"><i class="fa fa-check"></i><b>7.5</b> Show Detection History for a Specific Tag</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="activity-budget.html"><a href="activity-budget.html"><i class="fa fa-check"></i><b>8</b> Activity Budget</a>
<ul>
<li class="chapter" data-level="8.1" data-path="activity-budget.html"><a href="activity-budget.html#load-settings-1"><i class="fa fa-check"></i><b>8.1</b> Load settings</a></li>
<li class="chapter" data-level="8.2" data-path="activity-budget.html"><a href="activity-budget.html#load-tag-node-detection-data"><i class="fa fa-check"></i><b>8.2</b> Load Tag Node Detection Data</a></li>
<li class="chapter" data-level="8.3" data-path="activity-budget.html"><a href="activity-budget.html#tag-activity"><i class="fa fa-check"></i><b>8.3</b> Tag Activity</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="activity-budget.html"><a href="activity-budget.html#scatter-plot-of-rssi-vs-time-by-node"><i class="fa fa-check"></i><b>8.3.1</b> Scatter Plot of RSSI vs time by Node</a></li>
<li class="chapter" data-level="8.3.2" data-path="activity-budget.html"><a href="activity-budget.html#scatter-plot-of-activity-vs-time-by-node"><i class="fa fa-check"></i><b>8.3.2</b> Scatter Plot of activity vs time by Node</a></li>
<li class="chapter" data-level="8.3.3" data-path="activity-budget.html"><a href="activity-budget.html#d-histogram-of-activity-over-time"><i class="fa fa-check"></i><b>8.3.3</b> 2D Histogram of Activity over Time</a></li>
<li class="chapter" data-level="8.3.4" data-path="activity-budget.html"><a href="activity-budget.html#d-histogram-of-activity-vs-time-with-avg-activity"><i class="fa fa-check"></i><b>8.3.4</b> 2D histogram of activity vs time WITH avg activity</a></li>
<li class="chapter" data-level="8.3.5" data-path="activity-budget.html"><a href="activity-budget.html#avg-activity-hour-vs-time."><i class="fa fa-check"></i><b>8.3.5</b> Avg activity / hour Vs time.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="habitat-use.html"><a href="habitat-use.html"><i class="fa fa-check"></i><b>9</b> Habitat Use</a>
<ul>
<li class="chapter" data-level="9.1" data-path="habitat-use.html"><a href="habitat-use.html#load-libraries-and-settings"><i class="fa fa-check"></i><b>9.1</b> Load libraries and settings</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="habitat-use.html"><a href="habitat-use.html#activate-renv"><i class="fa fa-check"></i><b>9.1.1</b> Activate renv</a></li>
<li class="chapter" data-level="9.1.2" data-path="habitat-use.html"><a href="habitat-use.html#load-libraries-and-settings-1"><i class="fa fa-check"></i><b>9.1.2</b> Load libraries and settings</a></li>
<li class="chapter" data-level="9.1.3" data-path="habitat-use.html"><a href="habitat-use.html#load-functions"><i class="fa fa-check"></i><b>9.1.3</b> Load Functions</a></li>
<li class="chapter" data-level="9.1.4" data-path="habitat-use.html"><a href="habitat-use.html#load-rssi-coefficients"><i class="fa fa-check"></i><b>9.1.4</b> Load RSSI Coefficients</a></li>
<li class="chapter" data-level="9.1.5" data-path="habitat-use.html"><a href="habitat-use.html#load-settings-2"><i class="fa fa-check"></i><b>9.1.5</b> Load Settings</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="habitat-use.html"><a href="habitat-use.html#load-node-health-data-from-files-1"><i class="fa fa-check"></i><b>9.2</b> Load Node Health Data from Files</a></li>
<li class="chapter" data-level="9.3" data-path="habitat-use.html"><a href="habitat-use.html#get-node-locations-1"><i class="fa fa-check"></i><b>9.3</b> Get Node Locations</a></li>
<li class="chapter" data-level="9.4" data-path="habitat-use.html"><a href="habitat-use.html#load-station-detection-data"><i class="fa fa-check"></i><b>9.4</b> Load Station Detection Data</a></li>
<li class="chapter" data-level="9.5" data-path="habitat-use.html"><a href="habitat-use.html#build-a-grid"><i class="fa fa-check"></i><b>9.5</b> Build a Grid</a></li>
<li class="chapter" data-level="9.6" data-path="habitat-use.html"><a href="habitat-use.html#calculate-locations"><i class="fa fa-check"></i><b>9.6</b> Calculate Locations</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html"><i class="fa fa-check"></i><b>10</b> Grid Search Analysis</a>
<ul>
<li class="chapter" data-level="10.1" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#loading-settings"><i class="fa fa-check"></i><b>10.1</b> Loading Settings</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#activate-renv-1"><i class="fa fa-check"></i><b>10.1.1</b> Activate renv</a></li>
<li class="chapter" data-level="10.1.2" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#load-libraries"><i class="fa fa-check"></i><b>10.1.2</b> Load libraries</a></li>
<li class="chapter" data-level="10.1.3" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#load-settings-3"><i class="fa fa-check"></i><b>10.1.3</b> Load settings</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#load-node-health-data-from-database"><i class="fa fa-check"></i><b>10.2</b> Load Node Health data from Database</a></li>
<li class="chapter" data-level="10.3" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#get-node-locations-2"><i class="fa fa-check"></i><b>10.3</b> Get Node Locations</a></li>
<li class="chapter" data-level="10.4" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#load-station-detection-data-1"><i class="fa fa-check"></i><b>10.4</b> Load Station Detection Data</a></li>
<li class="chapter" data-level="10.5" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#build-a-node-grid"><i class="fa fa-check"></i><b>10.5</b> Build a Node Grid</a></li>
<li class="chapter" data-level="10.6" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#optional-calculate-test-solution"><i class="fa fa-check"></i><b>10.6</b> (Optional) Calculate Test Solution</a></li>
<li class="chapter" data-level="10.7" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#calculate-track"><i class="fa fa-check"></i><b>10.7</b> Calculate Track</a></li>
<li class="chapter" data-level="10.8" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#optional-compare-with-known-track"><i class="fa fa-check"></i><b>10.8</b> (Optional) Compare with Known Track</a></li>
<li class="chapter" data-level="10.9" data-path="grid-search-analysis.html"><a href="grid-search-analysis.html#plot-uncertainty-analysis"><i class="fa fa-check"></i><b>10.9</b> Plot Uncertainty Analysis</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="multilateration.html"><a href="multilateration.html"><i class="fa fa-check"></i><b>11</b> Multilateration</a>
<ul>
<li class="chapter" data-level="11.1" data-path="multilateration.html"><a href="multilateration.html#load-settings-4"><i class="fa fa-check"></i><b>11.1</b> Load settings</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="multilateration.html"><a href="multilateration.html#reset-rs-brain-remove-all-previous-objects"><i class="fa fa-check"></i><b>11.1.1</b> Reset R’s brain, remove all previous objects</a></li>
<li class="chapter" data-level="11.1.2" data-path="multilateration.html"><a href="multilateration.html#load-libraries-1"><i class="fa fa-check"></i><b>11.1.2</b> Load libraries</a></li>
<li class="chapter" data-level="11.1.3" data-path="multilateration.html"><a href="multilateration.html#re-create-sample-data-from-node-calibration-chapter-5"><i class="fa fa-check"></i><b>11.1.3</b> Re-create sample data from node calibration (Chapter 5)</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="multilateration.html"><a href="multilateration.html#isolate-raw-received-signal-strength-rss-data-from-node-network-associated-with-test-data"><i class="fa fa-check"></i><b>11.2</b> Isolate raw Received Signal Strength (RSS) data from Node network associated with Test Data</a></li>
<li class="chapter" data-level="11.3" data-path="multilateration.html"><a href="multilateration.html#exponential-decay-function---relationship-between-distance-and-tag-rss-values"><i class="fa fa-check"></i><b>11.3</b> Exponential Decay Function - Relationship between Distance and Tag RSS Values</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="multilateration.html"><a href="multilateration.html#preliminary-exponential-decay-model---determine-starting-values-for-the-final-model"><i class="fa fa-check"></i><b>11.3.1</b> Preliminary Exponential Decay Model - Determine starting values for the final model</a></li>
<li class="chapter" data-level="11.3.2" data-path="multilateration.html"><a href="multilateration.html#final-exponential-decay-model"><i class="fa fa-check"></i><b>11.3.2</b> Final Exponential Decay Model</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">‘celltracktech’ Data Analysis package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="node-calibration" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Node Calibration<a href="node-calibration.html#node-calibration" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the previous chapter we saw that various ways that the node gps can differ, which can lead to inaccurate received signal strength indicators (RSSI) from the tag.</p>
<p>To account for any small changes in the gps values, we need to calibrate the node grid.
## Load library</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="node-calibration.html#cb31-1" tabindex="-1"></a><span class="fu">library</span>(celltracktech)</span></code></pre></div>
<div id="load-sidekick-data-file" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Load sidekick data file<a href="node-calibration.html#load-sidekick-data-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Place the .csv file generated by the CTT Sidekick into the sidekick folder:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="node-calibration.html#cb32-1" tabindex="-1"></a><span class="co"># Specify the path to the sidekick data file you recorded for calibration</span></span>
<span id="cb32-2"><a href="node-calibration.html#cb32-2" tabindex="-1"></a><span class="co"># it is best if you create a &#39;sidekick&#39; folder to store your calibration file(s).</span></span>
<span id="cb32-3"><a href="node-calibration.html#cb32-3" tabindex="-1"></a></span>
<span id="cb32-4"><a href="node-calibration.html#cb32-4" tabindex="-1"></a><span class="fu">create_outpath</span>(<span class="st">&#39;./data/Meadows V2/sidekick/&#39;</span>)</span></code></pre></div>
<p>The <code>celltracktech</code> package comes with the sidekick calibration file from the Meadows V2 site. For the purposes of this tutorial, we will save it as a .csv file and place it in the sidekick folder. If you were using your data, you would need to place the sidekick calibration file manuall in the sidekick folder.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="node-calibration.html#cb33-1" tabindex="-1"></a><span class="fu">write_csv</span>(celltracktech<span class="sc">::</span>sidekick_cal, <span class="st">&#39;./data/Meadows V2/sidekick/calibration.csv&#39;</span>)</span>
<span id="cb33-2"><a href="node-calibration.html#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="node-calibration.html#cb33-3" tabindex="-1"></a>sidekick_file_path <span class="ot">&lt;-</span> <span class="st">&#39;./data/Meadows V2/sidekick/calibration.csv&#39;</span></span></code></pre></div>
<div id="if-you-do-not-have-a-sidekick-data-file" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> IF YOU DO NOT HAVE A SIDEKICK DATA FILE:<a href="node-calibration.html#if-you-do-not-have-a-sidekick-data-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Create your own sidekick file by walking with a tag through node grid, stopping at specific spots you choose, and note the gps coordinates and time. Then create a csv similar to the sidekick calibration file.</p>
<p>Example:</p>
<table>
<colgroup>
<col width="16%" />
<col width="11%" />
<col width="15%" />
<col width="7%" />
<col width="5%" />
<col width="5%" />
<col width="13%" />
<col width="24%" />
</colgroup>
<thead>
<tr class="header">
<th>tag_type</th>
<th>tag_id</th>
<th>time_utc</th>
<th>rssi</th>
<th>lat</th>
<th>lon</th>
<th>heading</th>
<th>antenna_angle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>radio434mhz</td>
<td>4C34074B</td>
<td>2023-08-03 19:42:44.721001Z</td>
<td></td>
<td>38.935561</td>
<td>-74.948195</td>
<td>24.273</td>
<td></td>
</tr>
<tr class="even">
<td>radio434mhz</td>
<td>072A6633</td>
<td>2023-08-03 19:42:45.307456Z</td>
<td></td>
<td>38.935561</td>
<td>-74.948195</td>
<td>23.548</td>
<td></td>
</tr>
<tr class="odd">
<td>radio434mhz</td>
<td>19332A07</td>
<td>2023-08-03 19:42:48.366123Z</td>
<td></td>
<td>38.935569</td>
<td>-74.948195</td>
<td>15.840</td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="setup" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Setup<a href="node-calibration.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="load-environmental-variables-into-rstudio" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Load environmental variables into RStudio<a href="node-calibration.html#load-environmental-variables-into-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="node-calibration.html#cb34-1" tabindex="-1"></a><span class="co"># load env file into environment</span></span>
<span id="cb34-2"><a href="node-calibration.html#cb34-2" tabindex="-1"></a><span class="fu">load_dot_env</span>(<span class="at">file=</span><span class="st">&#39;.env&#39;</span>)</span></code></pre></div>
</div>
<div id="load-settings" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Load settings<a href="node-calibration.html#load-settings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="node-calibration.html#cb35-1" tabindex="-1"></a><span class="co"># Settings - ----------------------------------------------------------------</span></span>
<span id="cb35-2"><a href="node-calibration.html#cb35-2" tabindex="-1"></a></span>
<span id="cb35-3"><a href="node-calibration.html#cb35-3" tabindex="-1"></a><span class="co"># set significant digits (number of digits after decimal)</span></span>
<span id="cb35-4"><a href="node-calibration.html#cb35-4" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">10</span>)</span>
<span id="cb35-5"><a href="node-calibration.html#cb35-5" tabindex="-1"></a></span>
<span id="cb35-6"><a href="node-calibration.html#cb35-6" tabindex="-1"></a><span class="co"># These were created in Chapter 2. If you do not have these in your project directory, go back and repeat Ch. 2.</span></span>
<span id="cb35-7"><a href="node-calibration.html#cb35-7" tabindex="-1"></a>my_token <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">&#39;API_KEY&#39;</span>) <span class="co"># load env variable into my_token</span></span>
<span id="cb35-8"><a href="node-calibration.html#cb35-8" tabindex="-1"></a>myproject <span class="ot">&lt;-</span> <span class="st">&quot;Meadows V2&quot;</span> <span class="co"># this is your project name on your CTT account, here we are using the CTT project &#39;Meadows V2&#39;</span></span>
<span id="cb35-9"><a href="node-calibration.html#cb35-9" tabindex="-1"></a>outpath <span class="ot">&lt;-</span> <span class="st">&quot;./data/&quot;</span> <span class="co"># where your downloaded files are to go</span></span>
<span id="cb35-10"><a href="node-calibration.html#cb35-10" tabindex="-1"></a></span>
<span id="cb35-11"><a href="node-calibration.html#cb35-11" tabindex="-1"></a><span class="co"># Specify the path to your database file</span></span>
<span id="cb35-12"><a href="node-calibration.html#cb35-12" tabindex="-1"></a>database_file <span class="ot">&lt;-</span> <span class="st">&quot;./data/Meadows V2/meadows.duckdb&quot;</span></span>
<span id="cb35-13"><a href="node-calibration.html#cb35-13" tabindex="-1"></a></span>
<span id="cb35-14"><a href="node-calibration.html#cb35-14" tabindex="-1"></a><span class="co"># Specify the tag ID that you used in your calibration</span></span>
<span id="cb35-15"><a href="node-calibration.html#cb35-15" tabindex="-1"></a>my_tag_id <span class="ot">&lt;-</span> <span class="st">&quot;072A6633&quot;</span></span>
<span id="cb35-16"><a href="node-calibration.html#cb35-16" tabindex="-1"></a><span class="co"># my_tag_id &lt;- &quot;614B661E&quot;</span></span>
<span id="cb35-17"><a href="node-calibration.html#cb35-17" tabindex="-1"></a></span>
<span id="cb35-18"><a href="node-calibration.html#cb35-18" tabindex="-1"></a><span class="co"># Specify the time range of node data you want to import for this analysis</span></span>
<span id="cb35-19"><a href="node-calibration.html#cb35-19" tabindex="-1"></a><span class="co">#   This range should cover a large time window where you nodes were in</span></span>
<span id="cb35-20"><a href="node-calibration.html#cb35-20" tabindex="-1"></a><span class="co">#   a constant location.  All node health records in this time window</span></span>
<span id="cb35-21"><a href="node-calibration.html#cb35-21" tabindex="-1"></a><span class="co">#   will be used to accurately determine the position of your nodes</span></span>
<span id="cb35-22"><a href="node-calibration.html#cb35-22" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2023-08-01 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;GMT&quot;</span>)</span>
<span id="cb35-23"><a href="node-calibration.html#cb35-23" tabindex="-1"></a>stop_time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2023-08-07 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;GMT&quot;</span>)</span>
<span id="cb35-24"><a href="node-calibration.html#cb35-24" tabindex="-1"></a></span>
<span id="cb35-25"><a href="node-calibration.html#cb35-25" tabindex="-1"></a><span class="co"># Specify a list of node Ids if you only want to include a subset in calibration</span></span>
<span id="cb35-26"><a href="node-calibration.html#cb35-26" tabindex="-1"></a><span class="co"># IF you want to use all nodes, ignore this line and SKIP the step below</span></span>
<span id="cb35-27"><a href="node-calibration.html#cb35-27" tabindex="-1"></a><span class="co"># where the data frame is trimmed to only nodes in this list</span></span>
<span id="cb35-28"><a href="node-calibration.html#cb35-28" tabindex="-1"></a>my_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B25AC19E&quot;</span>, <span class="st">&quot;44F8E426&quot;</span>, <span class="st">&quot;FAB6E12&quot;</span>, <span class="st">&quot;1EE02113&quot;</span>, <span class="st">&quot;565AA5B9&quot;</span>, <span class="st">&quot;EE799439&quot;</span>, <span class="st">&quot;1E762CF3&quot;</span>, <span class="st">&quot;A837A3F4&quot;</span>, <span class="st">&quot;484ED33B&quot;</span>)</span>
<span id="cb35-29"><a href="node-calibration.html#cb35-29" tabindex="-1"></a></span>
<span id="cb35-30"><a href="node-calibration.html#cb35-30" tabindex="-1"></a><span class="co"># You can specify an alternative map tile URL to use here</span></span>
<span id="cb35-31"><a href="node-calibration.html#cb35-31" tabindex="-1"></a>my_tile_url <span class="ot">&lt;-</span> <span class="st">&quot;https://mt2.google.com/vt/lyrs=y&amp;x={x}&amp;y={y}&amp;z={z}&quot;</span></span></code></pre></div>
</div>
<div id="load-node-health-data-from-files" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Load Node Health Data from Files<a href="node-calibration.html#load-node-health-data-from-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="node-calibration.html#cb36-1" tabindex="-1"></a><span class="co"># connect to the database</span></span>
<span id="cb36-2"><a href="node-calibration.html#cb36-2" tabindex="-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), </span>
<span id="cb36-3"><a href="node-calibration.html#cb36-3" tabindex="-1"></a>                      <span class="at">dbdir =</span> database_file, </span>
<span id="cb36-4"><a href="node-calibration.html#cb36-4" tabindex="-1"></a>                      <span class="at">read_only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-5"><a href="node-calibration.html#cb36-5" tabindex="-1"></a></span>
<span id="cb36-6"><a href="node-calibration.html#cb36-6" tabindex="-1"></a><span class="co"># load node_health table in to RStudio and subset it based on your start and stop times</span></span>
<span id="cb36-7"><a href="node-calibration.html#cb36-7" tabindex="-1"></a>node_health_df <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">&quot;node_health&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-8"><a href="node-calibration.html#cb36-8" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">&gt;=</span> start_time <span class="sc">&amp;</span> time <span class="sc">&lt;=</span> stop_time) <span class="sc">|&gt;</span></span>
<span id="cb36-9"><a href="node-calibration.html#cb36-9" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb36-10"><a href="node-calibration.html#cb36-10" tabindex="-1"></a></span>
<span id="cb36-11"><a href="node-calibration.html#cb36-11" tabindex="-1"></a><span class="co"># disconnect from the database</span></span>
<span id="cb36-12"><a href="node-calibration.html#cb36-12" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb36-13"><a href="node-calibration.html#cb36-13" tabindex="-1"></a></span>
<span id="cb36-14"><a href="node-calibration.html#cb36-14" tabindex="-1"></a><span class="co"># remove any duplicate records</span></span>
<span id="cb36-15"><a href="node-calibration.html#cb36-15" tabindex="-1"></a>node_health_df <span class="ot">&lt;-</span> node_health_df <span class="sc">%&gt;%</span> </span>
<span id="cb36-16"><a href="node-calibration.html#cb36-16" tabindex="-1"></a>  <span class="fu">distinct</span>(node_id, </span>
<span id="cb36-17"><a href="node-calibration.html#cb36-17" tabindex="-1"></a>           time, </span>
<span id="cb36-18"><a href="node-calibration.html#cb36-18" tabindex="-1"></a>           recorded_at, </span>
<span id="cb36-19"><a href="node-calibration.html#cb36-19" tabindex="-1"></a>           <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="get-node-locations" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> Get Node Locations<a href="node-calibration.html#get-node-locations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="node-calibration.html#cb37-1" tabindex="-1"></a><span class="co"># Calculate the average node locations</span></span>
<span id="cb37-2"><a href="node-calibration.html#cb37-2" tabindex="-1"></a>node_locs <span class="ot">&lt;-</span> <span class="fu">calculate_node_locations</span>(node_health_df)</span>
<span id="cb37-3"><a href="node-calibration.html#cb37-3" tabindex="-1"></a></span>
<span id="cb37-4"><a href="node-calibration.html#cb37-4" tabindex="-1"></a><span class="co"># Plot the average node locations</span></span>
<span id="cb37-5"><a href="node-calibration.html#cb37-5" tabindex="-1"></a>node_loc_plot <span class="ot">&lt;-</span> <span class="fu">plot_node_locations</span>(node_health_df, </span>
<span id="cb37-6"><a href="node-calibration.html#cb37-6" tabindex="-1"></a>                                     node_locs,</span>
<span id="cb37-7"><a href="node-calibration.html#cb37-7" tabindex="-1"></a>                                     <span class="at">theme =</span> <span class="fu">classic_plot_theme</span>())</span>
<span id="cb37-8"><a href="node-calibration.html#cb37-8" tabindex="-1"></a>node_loc_plot</span></code></pre></div>
<div class="float">
<img src="images/node_calibration_2.4_node_loc_plot.png" alt="Node location plot" />
<div class="figcaption">Node location plot</div>
</div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="node-calibration.html#cb38-1" tabindex="-1"></a><span class="co"># Write the node locations to a file</span></span>
<span id="cb38-2"><a href="node-calibration.html#cb38-2" tabindex="-1"></a><span class="fu">create_outpath</span>(<span class="st">&#39;results&#39;</span>)</span>
<span id="cb38-3"><a href="node-calibration.html#cb38-3" tabindex="-1"></a></span>
<span id="cb38-4"><a href="node-calibration.html#cb38-4" tabindex="-1"></a><span class="fu">export_node_locations</span>(<span class="st">&quot;results/node_locations.csv&quot;</span>, </span>
<span id="cb38-5"><a href="node-calibration.html#cb38-5" tabindex="-1"></a>                      node_locs)</span>
<span id="cb38-6"><a href="node-calibration.html#cb38-6" tabindex="-1"></a></span>
<span id="cb38-7"><a href="node-calibration.html#cb38-7" tabindex="-1"></a><span class="co"># Draw a map with the node locations</span></span>
<span id="cb38-8"><a href="node-calibration.html#cb38-8" tabindex="-1"></a>node_map <span class="ot">&lt;-</span> <span class="fu">map_node_locations</span>(node_locs, </span>
<span id="cb38-9"><a href="node-calibration.html#cb38-9" tabindex="-1"></a>                               <span class="at">tile_url =</span> my_tile_url)</span>
<span id="cb38-10"><a href="node-calibration.html#cb38-10" tabindex="-1"></a>node_map</span></code></pre></div>
<div class="float">
<img src="images/node_calibration_2.4_node_map.png" alt="Node location map" />
<div class="figcaption">Node location map</div>
</div>
</div>
<div id="load-station-detection-from-files" class="section level3 hasAnchor" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> Load Station Detection from Files<a href="node-calibration.html#load-station-detection-from-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="node-calibration.html#cb39-1" tabindex="-1"></a><span class="co"># connect to database</span></span>
<span id="cb39-2"><a href="node-calibration.html#cb39-2" tabindex="-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), </span>
<span id="cb39-3"><a href="node-calibration.html#cb39-3" tabindex="-1"></a>                      <span class="at">dbdir =</span> database_file, </span>
<span id="cb39-4"><a href="node-calibration.html#cb39-4" tabindex="-1"></a>                      <span class="at">read_only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-5"><a href="node-calibration.html#cb39-5" tabindex="-1"></a></span>
<span id="cb39-6"><a href="node-calibration.html#cb39-6" tabindex="-1"></a><span class="co"># load raw data table and filter from start_time to stop_time</span></span>
<span id="cb39-7"><a href="node-calibration.html#cb39-7" tabindex="-1"></a>detection_df <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">&quot;raw&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-8"><a href="node-calibration.html#cb39-8" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">&gt;=</span> start_time <span class="sc">&amp;&amp;</span> time <span class="sc">&lt;=</span> stop_time) <span class="sc">|&gt;</span></span>
<span id="cb39-9"><a href="node-calibration.html#cb39-9" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb39-10"><a href="node-calibration.html#cb39-10" tabindex="-1"></a></span>
<span id="cb39-11"><a href="node-calibration.html#cb39-11" tabindex="-1"></a><span class="co"># if you are working with blu data, uncomment the lines below and load data from the blu table</span></span>
<span id="cb39-12"><a href="node-calibration.html#cb39-12" tabindex="-1"></a><span class="co"># detection_blu &lt;- tbl(con, &quot;blu&quot;) |&gt;</span></span>
<span id="cb39-13"><a href="node-calibration.html#cb39-13" tabindex="-1"></a><span class="co">#   filter(time &gt;= start_time &amp;&amp; time &lt;= stop_time) |&gt;</span></span>
<span id="cb39-14"><a href="node-calibration.html#cb39-14" tabindex="-1"></a><span class="co">#   collect</span></span>
<span id="cb39-15"><a href="node-calibration.html#cb39-15" tabindex="-1"></a></span>
<span id="cb39-16"><a href="node-calibration.html#cb39-16" tabindex="-1"></a><span class="co"># disconnect from database</span></span>
<span id="cb39-17"><a href="node-calibration.html#cb39-17" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb39-18"><a href="node-calibration.html#cb39-18" tabindex="-1"></a></span>
<span id="cb39-19"><a href="node-calibration.html#cb39-19" tabindex="-1"></a><span class="co"># Get beeps from test tag only</span></span>
<span id="cb39-20"><a href="node-calibration.html#cb39-20" tabindex="-1"></a>detection_df <span class="ot">&lt;-</span> <span class="fu">subset.data.frame</span>(detection_df, </span>
<span id="cb39-21"><a href="node-calibration.html#cb39-21" tabindex="-1"></a>                                  tag_id <span class="sc">==</span> my_tag_id)</span></code></pre></div>
</div>
<div id="load-sidekick-calibration-data" class="section level3 hasAnchor" number="6.2.6">
<h3><span class="header-section-number">6.2.6</span> Load Sidekick Calibration Data<a href="node-calibration.html#load-sidekick-calibration-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="node-calibration.html#cb40-1" tabindex="-1"></a><span class="co"># Get Sidekick data from CSV</span></span>
<span id="cb40-2"><a href="node-calibration.html#cb40-2" tabindex="-1"></a>sidekick_all_df <span class="ot">&lt;-</span> <span class="fu">load_sidekick_data</span>(sidekick_file_path)</span>
<span id="cb40-3"><a href="node-calibration.html#cb40-3" tabindex="-1"></a></span>
<span id="cb40-4"><a href="node-calibration.html#cb40-4" tabindex="-1"></a><span class="co"># Get beeps from test tag only</span></span>
<span id="cb40-5"><a href="node-calibration.html#cb40-5" tabindex="-1"></a>sidekick_tag_df <span class="ot">&lt;-</span> <span class="fu">subset.data.frame</span>(sidekick_all_df, </span>
<span id="cb40-6"><a href="node-calibration.html#cb40-6" tabindex="-1"></a>                                     tag_id <span class="sc">==</span> my_tag_id)</span>
<span id="cb40-7"><a href="node-calibration.html#cb40-7" tabindex="-1"></a></span>
<span id="cb40-8"><a href="node-calibration.html#cb40-8" tabindex="-1"></a><span class="co"># Show location of all beeps in relation to node locations</span></span>
<span id="cb40-9"><a href="node-calibration.html#cb40-9" tabindex="-1"></a>calibration_map <span class="ot">&lt;-</span> <span class="fu">map_calibration_track</span>(node_locs, </span>
<span id="cb40-10"><a href="node-calibration.html#cb40-10" tabindex="-1"></a>                                         sidekick_tag_df, </span>
<span id="cb40-11"><a href="node-calibration.html#cb40-11" tabindex="-1"></a>                                         <span class="at">tile_url =</span> my_tile_url)</span>
<span id="cb40-12"><a href="node-calibration.html#cb40-12" tabindex="-1"></a></span>
<span id="cb40-13"><a href="node-calibration.html#cb40-13" tabindex="-1"></a>calibration_map</span></code></pre></div>
<div class="float">
<img src="images/node_calibration_2.5_sidekick_calibration.png" alt="Node location plot" />
<div class="figcaption">Node location plot</div>
</div>
</div>
</div>
<div id="calculate-the-rssi-vs.-distance-relationship" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Calculate the RSSI vs. Distance Relationship<a href="node-calibration.html#calculate-the-rssi-vs.-distance-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function will match sidekick detections to detections recorded by nodes and sent to the station. Then using the sidekick location, the node locations calculated above, and the rssi measured in the node, a list of rssi and distance pairs is generated and returned.</p>
<p>For Blu Series tags use_sync=TRUE, for 434 MHz tags use_sync=FALSE.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="node-calibration.html#cb41-1" tabindex="-1"></a>rssi_v_dist <span class="ot">&lt;-</span> <span class="fu">calc_rssi_v_dist</span>(<span class="at">node_locs =</span> node_locs, </span>
<span id="cb41-2"><a href="node-calibration.html#cb41-2" tabindex="-1"></a>                                <span class="at">sidekick_tag_df =</span> sidekick_tag_df, </span>
<span id="cb41-3"><a href="node-calibration.html#cb41-3" tabindex="-1"></a>                                <span class="at">detection_df =</span> detection_df, </span>
<span id="cb41-4"><a href="node-calibration.html#cb41-4" tabindex="-1"></a>                                <span class="at">use_sync =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-5"><a href="node-calibration.html#cb41-5" tabindex="-1"></a></span>
<span id="cb41-6"><a href="node-calibration.html#cb41-6" tabindex="-1"></a><span class="co"># Plot the resulting RSSI and distance data</span></span>
<span id="cb41-7"><a href="node-calibration.html#cb41-7" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-8"><a href="node-calibration.html#cb41-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> rssi_v_dist, </span>
<span id="cb41-9"><a href="node-calibration.html#cb41-9" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> distance, </span>
<span id="cb41-10"><a href="node-calibration.html#cb41-10" tabindex="-1"></a>                 <span class="at">y =</span> rssi, </span>
<span id="cb41-11"><a href="node-calibration.html#cb41-11" tabindex="-1"></a>                 <span class="at">colour =</span> node_id)) <span class="sc">+</span></span>
<span id="cb41-12"><a href="node-calibration.html#cb41-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;RSSI vs. Distance&quot;</span>,</span>
<span id="cb41-13"><a href="node-calibration.html#cb41-13" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Distance (m)&quot;</span>,</span>
<span id="cb41-14"><a href="node-calibration.html#cb41-14" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;RSSI (dBm)&quot;</span>,</span>
<span id="cb41-15"><a href="node-calibration.html#cb41-15" tabindex="-1"></a>       <span class="at">colour=</span><span class="st">&quot;Node ID&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-16"><a href="node-calibration.html#cb41-16" tabindex="-1"></a>  <span class="fu">classic_plot_theme</span>()</span></code></pre></div>
<div class="float">
<img src="images/node_calibration_3.1_calculate_rssi_vs_distance.png" alt="RSSI vs. Distance" />
<div class="figcaption">RSSI vs. Distance</div>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="node-calibration.html#cb42-1" tabindex="-1"></a><span class="co"># Fit the RSSI vs distance data with exponential relationship</span></span>
<span id="cb42-2"><a href="node-calibration.html#cb42-2" tabindex="-1"></a>nlsfit <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb42-3"><a href="node-calibration.html#cb42-3" tabindex="-1"></a>  rssi <span class="sc">~</span> a <span class="sc">-</span> b <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>c <span class="sc">*</span> distance),</span>
<span id="cb42-4"><a href="node-calibration.html#cb42-4" tabindex="-1"></a>  rssi_v_dist,</span>
<span id="cb42-5"><a href="node-calibration.html#cb42-5" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="sc">-</span><span class="dv">105</span>, <span class="at">b =</span> <span class="sc">-</span><span class="dv">60</span>, <span class="at">c =</span> <span class="fl">0.17</span>)</span>
<span id="cb42-6"><a href="node-calibration.html#cb42-6" tabindex="-1"></a>)</span>
<span id="cb42-7"><a href="node-calibration.html#cb42-7" tabindex="-1"></a></span>
<span id="cb42-8"><a href="node-calibration.html#cb42-8" tabindex="-1"></a><span class="fu">summary</span>(nlsfit)</span>
<span id="cb42-9"><a href="node-calibration.html#cb42-9" tabindex="-1"></a></span>
<span id="cb42-10"><a href="node-calibration.html#cb42-10" tabindex="-1"></a><span class="co"># Get the coefficients from the fit result</span></span>
<span id="cb42-11"><a href="node-calibration.html#cb42-11" tabindex="-1"></a>co <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(nlsfit))</span>
<span id="cb42-12"><a href="node-calibration.html#cb42-12" tabindex="-1"></a>rssi_coefs <span class="ot">&lt;-</span> <span class="fu">c</span>(co[<span class="dv">1</span>, <span class="dv">1</span>], co[<span class="dv">2</span>, <span class="dv">1</span>], co[<span class="dv">3</span>, <span class="dv">1</span>])</span>
<span id="cb42-13"><a href="node-calibration.html#cb42-13" tabindex="-1"></a></span>
<span id="cb42-14"><a href="node-calibration.html#cb42-14" tabindex="-1"></a><span class="co"># Add a predicted column to the RSSI vs distance data</span></span>
<span id="cb42-15"><a href="node-calibration.html#cb42-15" tabindex="-1"></a>rssi_v_dist<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(nlsfit)</span>
<span id="cb42-16"><a href="node-calibration.html#cb42-16" tabindex="-1"></a></span>
<span id="cb42-17"><a href="node-calibration.html#cb42-17" tabindex="-1"></a><span class="co"># Plot the RSSI vs distance data with the fit curve</span></span>
<span id="cb42-18"><a href="node-calibration.html#cb42-18" tabindex="-1"></a>calibration_plot <span class="ot">&lt;-</span> <span class="fu">plot_calibration_result</span>(rssi_v_dist, <span class="fu">classic_plot_theme</span>())</span>
<span id="cb42-19"><a href="node-calibration.html#cb42-19" tabindex="-1"></a>calibration_plot</span>
<span id="cb42-20"><a href="node-calibration.html#cb42-20" tabindex="-1"></a></span>
<span id="cb42-21"><a href="node-calibration.html#cb42-21" tabindex="-1"></a><span class="co"># Print the coefficients from the fit. You&#39;ll need these coefficients later</span></span>
<span id="cb42-22"><a href="node-calibration.html#cb42-22" tabindex="-1"></a><span class="co"># for localization.</span></span>
<span id="cb42-23"><a href="node-calibration.html#cb42-23" tabindex="-1"></a><span class="fu">print</span>(rssi_coefs)</span></code></pre></div>
<div class="float">
<img src="images/node_calibration_3.1_fit_relationship.png" alt="RSSI vs. Distance" />
<div class="figcaption">RSSI vs. Distance</div>
</div>
<p>Your node grid is now calibrated!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="node-check.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="presenceabsence-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/rstudio/bookdown-demo/edit/master/05-node-calibration.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
