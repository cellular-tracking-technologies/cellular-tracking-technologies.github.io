<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Localization Methods | Cellular Tracking Technologies: Data Tools</title>
  <meta name="description" content="This is a manual for the R data tools" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Localization Methods | Cellular Tracking Technologies: Data Tools" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a manual for the R data tools" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Localization Methods | Cellular Tracking Technologies: Data Tools" />
  
  <meta name="twitter:description" content="This is a manual for the R data tools" />
  

<meta name="author" content="Jessica Gorzo" />


<meta name="date" content="2021-05-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="about-the-functions.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CTT Data Tools</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-github"><i class="fa fa-check"></i>How to use GitHub</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> API</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#install-postgres"><i class="fa fa-check"></i><b>1.1</b> Install Postgres</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#your-token"><i class="fa fa-check"></i><b>1.2</b> Your Token</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#r-script-api_run.r"><i class="fa fa-check"></i><b>1.3</b> R script: api_run.R</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#terminal"><i class="fa fa-check"></i><b>1.4</b> Terminal</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="start-here-example-scripts.html"><a href="start-here-example-scripts.html"><i class="fa fa-check"></i><b>2</b> Start Here: Example Scripts</a></li>
<li class="chapter" data-level="3" data-path="about-the-functions.html"><a href="about-the-functions.html"><i class="fa fa-check"></i><b>3</b> About the Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="about-the-functions.html"><a href="about-the-functions.html#data-manager"><i class="fa fa-check"></i><b>3.1</b> Data Manager</a><ul>
<li class="chapter" data-level="3.1.1" data-path="about-the-functions.html"><a href="about-the-functions.html#load_datainfile"><i class="fa fa-check"></i><b>3.1.1</b> load_data(infile)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="about-the-functions.html"><a href="about-the-functions.html#node-health"><i class="fa fa-check"></i><b>3.2</b> Node Health</a><ul>
<li class="chapter" data-level="3.2.1" data-path="about-the-functions.html"><a href="about-the-functions.html#node_channel_plotshealth-freq"><i class="fa fa-check"></i><b>3.2.1</b> node_channel_plots(health, freq)</a></li>
<li class="chapter" data-level="3.2.2" data-path="about-the-functions.html"><a href="about-the-functions.html#v2_plotshealth-freq"><i class="fa fa-check"></i><b>3.2.2</b> v2_plots(health, freq)</a></li>
<li class="chapter" data-level="3.2.3" data-path="about-the-functions.html"><a href="about-the-functions.html#node_plotshealth-nodes-freq"><i class="fa fa-check"></i><b>3.2.3</b> node_plots(health, nodes, freq)</a></li>
<li class="chapter" data-level="3.2.4" data-path="about-the-functions.html"><a href="about-the-functions.html#gps_plotsgps-freq"><i class="fa fa-check"></i><b>3.2.4</b> gps_plots(gps, freq)</a></li>
<li class="chapter" data-level="3.2.5" data-path="about-the-functions.html"><a href="about-the-functions.html#export_node_channel_plotshealth_data-freq-out_path-x-y-z"><i class="fa fa-check"></i><b>3.2.5</b> export_node_channel_plots(health_data, freq, out_path, x, y, z)</a></li>
<li class="chapter" data-level="3.2.6" data-path="about-the-functions.html"><a href="about-the-functions.html#export_node_plotshealth_data-freq-out_path-x-y-z"><i class="fa fa-check"></i><b>3.2.6</b> export_node_plots(health_data, freq, out_path, x, y, z)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="localization-methods.html"><a href="localization-methods.html"><i class="fa fa-check"></i><b>4</b> Localization Methods</a><ul>
<li class="chapter" data-level="4.1" data-path="localization-methods.html"><a href="localization-methods.html#primitive-weighted-average"><i class="fa fa-check"></i><b>4.1</b> Primitive: Weighted Average</a></li>
<li class="chapter" data-level="4.2" data-path="localization-methods.html"><a href="localization-methods.html#triangulation-functions"><i class="fa fa-check"></i><b>4.2</b> Triangulation Functions</a><ul>
<li class="chapter" data-level="4.2.1" data-path="localization-methods.html"><a href="localization-methods.html#data-prep"><i class="fa fa-check"></i><b>4.2.1</b> Data Prep</a></li>
<li class="chapter" data-level="4.2.2" data-path="localization-methods.html"><a href="localization-methods.html#calibration"><i class="fa fa-check"></i><b>4.2.2</b> Calibration</a></li>
<li class="chapter" data-level="4.2.3" data-path="localization-methods.html"><a href="localization-methods.html#custom-distance-function"><i class="fa fa-check"></i><b>4.2.3</b> Custom Distance Function</a></li>
<li class="chapter" data-level="4.2.4" data-path="localization-methods.html"><a href="localization-methods.html#triangulation"><i class="fa fa-check"></i><b>4.2.4</b> Triangulation</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cellular Tracking Technologies: Data Tools</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="localization-methods" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Localization Methods</h1>
<div id="primitive-weighted-average" class="section level2">
<h2><span class="header-section-number">4.1</span> Primitive: Weighted Average</h2>
<p>This is simply a weighted average based on number of beeps on a node and max. RSSI values. It takes the following mandatory arguments:<br />
* freq: this is the interval a localization should be summarized over, and is in the form of an interval (e.g. “3 min”)<br />
* beep_data: raw beep data frame (e.g. all_data[[1]][[1]] from example.R)<br />
* node: read in node file</p>
<p>locations &lt;- weighted_average(freq = “3 min”, beep_data, node = nodes, node_health, 0, tags)</p>
</div>
<div id="triangulation-functions" class="section level2">
<h2><span class="header-section-number">4.2</span> Triangulation Functions</h2>
<div id="data-prep" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Data Prep</h3>
<p>This function prepares beep data to be input into the triangulation.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="localization-methods.html#cb1-1"></a>input &lt;-<span class="st"> </span><span class="kw">loc_prep</span>(beep_data, nodes, freq)  </span></code></pre></div>
</div>
<div id="calibration" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Calibration</h3>
<p>This function preps the beep data frame for input into the triangulation function, and also implements a calibration by fitting an asymptotic function for RSSI and distance.</p>
<p>The calibration data frame needs the following column names:<br />
* pt: this can be any identifier for a given location used in the calibration<br />
* session_id: this can be any identifier for the time period the tag was at this spot<br />
* start: the beginning of the time interval when the tag was placed at the point, in POSIXct UTC<br />
* end: the end of the time interval when the tag was placed at the point, in POSIXct UTC<br />
* TagId: the tag ID left at the point<br />
* TagLat: latitude of the point<br />
* TagLng: longitude of the point</p>
<p>The option <code>calibrate = TRUE</code> is the default, and means that summary stats will be calculated over the entire time interval for each calibration location. Otherwise, pass <code>calibrate = FALSE, freq = &lt;interval&gt;</code> for the time interval of interest.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="localization-methods.html#cb2-1"></a>calibrated &lt;-<span class="st"> </span><span class="kw">calibrate</span>(beep_data, calibration, nodes, <span class="dt">calibrate =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>This function returns a list, the items of which are…<br />
1. data frame to be input into the triangulation<br />
2. a (see below)<br />
3. S (see below)<br />
4. K (see below)</p>
</div>
<div id="custom-distance-function" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Custom Distance Function</h3>
<p>You can pass a custom distance function, in the form of a string, that represents the relationship between RSSI and distance for your system. The string is the right side of the formula, where the left side is distance. The string needs to contain <code>x</code> which refers to RSSI. An example of an asymptotic relationship can be generated by the following function and the output of the calibrate function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="localization-methods.html#cb3-1"></a>relation &lt;-<span class="st"> </span><span class="kw">relate</span>(calibrated[[<span class="dv">2</span>]], calibrated[[<span class="dv">3</span>]], calibrated[[<span class="dv">4</span>]])</span></code></pre></div>
</div>
<div id="triangulation" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Triangulation</h3>
<p>This performs the triangulation with an input dataframe and defined distance relationship.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="localization-methods.html#cb4-1"></a>out &lt;-<span class="st"> </span><span class="kw">triangulate</span>(calibrated[[<span class="dv">1</span>]], <span class="dt">distance =</span> relation)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="about-the-functions.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-localization.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
