<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Localization Methods | Cellular Tracking Technologies: Data Tools</title>
  <meta name="description" content="This is a manual for the R data tools" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Localization Methods | Cellular Tracking Technologies: Data Tools" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a manual for the R data tools" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Localization Methods | Cellular Tracking Technologies: Data Tools" />
  
  <meta name="twitter:description" content="This is a manual for the R data tools" />
  

<meta name="author" content="Jessica Gorzo" />


<meta name="date" content="2022-10-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="CTT-FB-logo-STACKED.jpg" type="image/x-icon" />
<link rel="prev" href="calibration.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CTT Data Tools</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Instructions</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> API</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#local-database-option"><i class="fa fa-check"></i><b>1.1</b> Local Database Option</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#your-token"><i class="fa fa-check"></i><b>1.2</b> Your Token</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#r-script-api_run.r"><i class="fa fa-check"></i><b>1.3</b> R script: api_run.R</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#terminal"><i class="fa fa-check"></i><b>1.4</b> Terminal</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html"><i class="fa fa-check"></i><b>2</b> Tools to Work with Data</a>
<ul>
<li class="chapter" data-level="" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html#how-to-use-github"><i class="fa fa-check"></i>How to use GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html#getting-set-up"><i class="fa fa-check"></i>Getting Set Up</a></li>
<li class="chapter" data-level="" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html#result"><i class="fa fa-check"></i>Result</a></li>
</ul></li>
<li class="chapter" data-level="2.1" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html#pulling-data-into-r-from-your-local-database"><i class="fa fa-check"></i><b>2.1</b> Pulling Data into R from your Local Database</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="about-the-functions.html"><a href="about-the-functions.html"><i class="fa fa-check"></i><b>3</b> About the Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="about-the-functions.html"><a href="about-the-functions.html#data-manager"><i class="fa fa-check"></i><b>3.1</b> Data Manager</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="about-the-functions.html"><a href="about-the-functions.html#load_data"><i class="fa fa-check"></i><b>3.1.1</b> load_data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="about-the-functions.html"><a href="about-the-functions.html#node-health"><i class="fa fa-check"></i><b>3.2</b> Node Health</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="about-the-functions.html"><a href="about-the-functions.html#node_channel_plots"><i class="fa fa-check"></i><b>3.2.1</b> node_channel_plots</a></li>
<li class="chapter" data-level="3.2.2" data-path="about-the-functions.html"><a href="about-the-functions.html#node_plots"><i class="fa fa-check"></i><b>3.2.2</b> node_plots</a></li>
<li class="chapter" data-level="3.2.3" data-path="about-the-functions.html"><a href="about-the-functions.html#gps_plots"><i class="fa fa-check"></i><b>3.2.3</b> gps_plots</a></li>
<li class="chapter" data-level="3.2.4" data-path="about-the-functions.html"><a href="about-the-functions.html#export_node_channel_plots"><i class="fa fa-check"></i><b>3.2.4</b> export_node_channel_plots</a></li>
<li class="chapter" data-level="3.2.5" data-path="about-the-functions.html"><a href="about-the-functions.html#export_node_plots"><i class="fa fa-check"></i><b>3.2.5</b> export_node_plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="calibration.html"><a href="calibration.html"><i class="fa fa-check"></i><b>4</b> Calibration</a>
<ul>
<li class="chapter" data-level="4.1" data-path="calibration.html"><a href="calibration.html#description"><i class="fa fa-check"></i><b>4.1</b> Description</a></li>
<li class="chapter" data-level="4.2" data-path="calibration.html"><a href="calibration.html#tag-calibration"><i class="fa fa-check"></i><b>4.2</b> Tag Calibration</a></li>
<li class="chapter" data-level="4.3" data-path="calibration.html"><a href="calibration.html#node-calibration"><i class="fa fa-check"></i><b>4.3</b> Node Calibration</a></li>
<li class="chapter" data-level="4.4" data-path="calibration.html"><a href="calibration.html#how-to-use-the-output"><i class="fa fa-check"></i><b>4.4</b> How to Use the Output</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="localization-methods.html"><a href="localization-methods.html"><i class="fa fa-check"></i><b>5</b> Localization Methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="localization-methods.html"><a href="localization-methods.html#primitive-weighted-average"><i class="fa fa-check"></i><b>5.1</b> Primitive: Weighted Average</a></li>
<li class="chapter" data-level="5.2" data-path="localization-methods.html"><a href="localization-methods.html#triangulation-functions"><i class="fa fa-check"></i><b>5.2</b> Triangulation Functions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="localization-methods.html"><a href="localization-methods.html#calibration-1"><i class="fa fa-check"></i><b>5.2.1</b> Calibration</a></li>
<li class="chapter" data-level="5.2.2" data-path="localization-methods.html"><a href="localization-methods.html#custom-distance-function"><i class="fa fa-check"></i><b>5.2.2</b> Custom Distance Function</a></li>
<li class="chapter" data-level="5.2.3" data-path="localization-methods.html"><a href="localization-methods.html#data-prep"><i class="fa fa-check"></i><b>5.2.3</b> Data Prep</a></li>
<li class="chapter" data-level="5.2.4" data-path="localization-methods.html"><a href="localization-methods.html#triangulation"><i class="fa fa-check"></i><b>5.2.4</b> Triangulation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cellular Tracking Technologies: Data Tools</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="localization-methods" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Localization Methods<a href="localization-methods.html#localization-methods" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="primitive-weighted-average" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Primitive: Weighted Average<a href="localization-methods.html#primitive-weighted-average" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Description</strong><br />
This is simply a weighted average based on number of beeps on a node and max. RSSI values.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="localization-methods.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted_average</span>(freq, beeps, node, <span class="at">node_health=</span><span class="cn">NULL</span>, <span class="at">MAX_NODES=</span><span class="dv">0</span>, <span class="at">tag_id=</span><span class="cn">NULL</span>, <span class="at">calibrate =</span> <span class="cn">NULL</span>, <span class="at">keep_cols =</span> <span class="cn">NULL</span>, <span class="at">latlng =</span> <span class="cn">TRUE</span>, <span class="at">minRSSI =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li>freq: this is the interval a localization should be summarized over, and is in the form of an interval (e.g. <code>"3 min"</code>)<br />
</li>
<li>beep_data: raw beep data frame (e.g. <code>all_data[[1]][[1]]</code> from example.R)<br />
</li>
<li>node: read in node file<br />
</li>
<li>node_health: node health data frame</li>
<li>MAX_NODES: the max number of nodes that should contribute to a localization. default = 0 means all nodes</li>
<li>tag_id: a vector of tags to calculate locations for</li>
<li>calibrate: the session ID if you want to calculate over the entire duration a tag was left at a point</li>
<li>keep_cols: if there are valuable columns that shouldn’t be dropped</li>
<li>latlng: BUGGY DO NOT USE YET</li>
<li>minRSSI: the minimum RSSI of data used for the location estimate</li>
</ul>
<p><strong>Value</strong><br />
A SpatialPointsDataFrame of estimated locations</p>
</div>
<div id="triangulation-functions" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Triangulation Functions<a href="localization-methods.html#triangulation-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="calibration-1" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Calibration<a href="localization-methods.html#calibration-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Usage</strong><br />
NOTE: This function returns a single relationship for the entire input! The example code to date also demonstrates the output of 1 distance ~ RSSI relationship. In order to calibrate per tag, it will be necessary to modify your code to loop over (e.g. apply) each tag ID, sub-setting your input data accordingly.</p>
<p>You can also use this function if you e.g. left tags at a known location in your grid for a period of time. This function preps the beep data frame for input into the triangulation function, and also implements a calibration by fitting an asymptotic function for RSSI and distance.</p>
<p>The calibration data frame needs the following column names:</p>
<ul>
<li>pt: this can be any identifier for a given location used in the calibration<br />
</li>
<li>session_id: a character row identifier</li>
<li>start: the beginning of the time interval when the tag was placed at the point, in POSIXct UTC<br />
</li>
<li>end: the end of the time interval when the tag was placed at the point, in POSIXct UTC<br />
</li>
<li>TagId: the tag ID left at the point<br />
</li>
<li>TagLat: latitude of the point<br />
</li>
<li>TagLng: longitude of the point</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="localization-methods.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calibrate</span>(beep_data, calibration, nodes, <span class="at">calibrate =</span> <span class="cn">TRUE</span>, <span class="at">freq =</span> <span class="st">&quot;3 min&quot;</span>, <span class="at">max_nodes =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><strong>Arguments</strong><br />
The option <code>calibrate = TRUE</code> is the default, and means that summary stats will be calculated over the entire time interval for each calibration location. Otherwise, pass <code>calibrate = FALSE, freq = &lt;interval&gt;</code> for the time interval of interest.</p>
<ul>
<li>beep_data: beep data frame<br />
</li>
<li>calibration: data frame described above<br />
</li>
<li>nodes: node file<br />
</li>
<li>calibrate: whether or not the entire time interval a tag was at a point should be used for the estimation</li>
<li>freq: alternatively, specify an interval for location estimation</li>
<li>max_nodes: how many nodes should contribute? default = 0 means all nodes</li>
</ul>
<p><strong>Value</strong><br />
This function returns a list, the items of which are…</p>
<ol style="list-style-type: decimal">
<li>data frame to be input into the triangulation<br />
</li>
<li>a (see below)<br />
</li>
<li>S (see below)<br />
</li>
<li>K (see below)</li>
</ol>
</div>
<div id="custom-distance-function" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Custom Distance Function<a href="localization-methods.html#custom-distance-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Description</strong><br />
You can pass a custom distance function to the triangulation, in the form of a string, that represents the relationship between RSSI and distance for your system. The string that you pass is the right side of the formula, where the left side is distance. The string needs to contain <code>x</code> which refers to RSSI. An example of an asymptotic relationship can be generated by the following function and the output of the calibrate function:</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="localization-methods.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">relate</span>(a, S, K)</span></code></pre></div>
<p><strong>Arguments</strong><br />
These are fitted coefficients from an <code>SSasymp()</code> model relating distance to RSSI</p>
<ul>
<li>a = R0 e.g. the 2nd item returned from the calibrate function<br />
</li>
<li>S = exp(lrc) e.g. the 3rd item returned from the calibrate function<br />
</li>
<li>K = Aysm e.g. the 4th item returned from the calibrate function</li>
</ul>
<p><strong>Value</strong><br />
Inspect that string if you would like to instead create your own (e.g. for tag-wise calibration)</p>
</div>
<div id="data-prep" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Data Prep<a href="localization-methods.html#data-prep" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Description</strong><br />
This function prepares beep data to be input into the triangulation.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="localization-methods.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loc_prep</span>(beep_data, nodes, freq) </span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li>beep_data: beep data frame<br />
</li>
<li>nodes: node file<br />
</li>
<li>freq: interval to calculate locations over</li>
</ul>
<p><strong>Value</strong><br />
A data frame that can be used as input to the <code>triangulate()</code> function</p>
</div>
<div id="triangulation" class="section level3 hasAnchor" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Triangulation<a href="localization-methods.html#triangulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Description</strong><br />
This performs the triangulation with an input data frame and defined distance relationship. You could e.g. fit a relationship between distance and RSSI based on your calibration work.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="localization-methods.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">triangulate</span>(all_data, <span class="at">rssi =</span> <span class="sc">-</span><span class="dv">100</span>, <span class="at">node =</span> <span class="dv">3</span>, <span class="at">distance =</span> relation)</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li>all_data: a formatted data frame, such as the output from <code>loc_prep()</code> or the data frame returned by <code>calibrate()</code><br />
</li>
<li>rssi: the minimum RSSI threshold to incorporate data into the location calculation<br />
</li>
<li>node: the maximum number of nodes to contribute to the calculation<br />
</li>
<li>distance: a string representing the right side of a formula relating RSSI to distance, where distance is the left side and RSSI is <code>x</code> in the string</li>
</ul>
<p><strong>Value</strong><br />
A data frame with estimated locations and error</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="calibration.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-localization.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
