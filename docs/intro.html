<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 API | Cellular Tracking Technologies: Data Tools</title>
  <meta name="description" content="This is a manual for the R data tools" />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 API | Cellular Tracking Technologies: Data Tools" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a manual for the R data tools" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 API | Cellular Tracking Technologies: Data Tools" />
  
  <meta name="twitter:description" content="This is a manual for the R data tools" />
  

<meta name="author" content="Jessica Gorzo" />


<meta name="date" content="2022-12-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="CTT-FB-logo-STACKED.jpg" type="image/x-icon" />
<link rel="prev" href="index.html"/>
<link rel="next" href="tools-to-work-with-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>



<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CTT Data Tools</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Instructions</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> API</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#local-database-option"><i class="fa fa-check"></i><b>1.1</b> Local Database Option</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#your-token"><i class="fa fa-check"></i><b>1.2</b> Your Token</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#r-script-api_run.r"><i class="fa fa-check"></i><b>1.3</b> R script: api_run.R</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#terminal"><i class="fa fa-check"></i><b>1.4</b> Terminal</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#data-cleaning"><i class="fa fa-check"></i><b>1.5</b> Data Cleaning</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#incorporating-node-data-into-your-database"><i class="fa fa-check"></i><b>1.6</b> Incorporating Node Data Into Your Database</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html"><i class="fa fa-check"></i><b>2</b> Tools to Work with Data</a>
<ul>
<li class="chapter" data-level="" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html#how-to-use-github"><i class="fa fa-check"></i>How to use GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html#getting-set-up"><i class="fa fa-check"></i>Getting Set Up</a></li>
<li class="chapter" data-level="" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html#result"><i class="fa fa-check"></i>Result</a></li>
</ul></li>
<li class="chapter" data-level="2.1" data-path="tools-to-work-with-data.html"><a href="tools-to-work-with-data.html#pulling-data-into-r-from-your-local-database"><i class="fa fa-check"></i><b>2.1</b> Pulling Data into R from your Local Database</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="about-the-functions.html"><a href="about-the-functions.html"><i class="fa fa-check"></i><b>3</b> About the Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="about-the-functions.html"><a href="about-the-functions.html#data-manager"><i class="fa fa-check"></i><b>3.1</b> Data Manager</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="about-the-functions.html"><a href="about-the-functions.html#load_data"><i class="fa fa-check"></i><b>3.1.1</b> load_data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="about-the-functions.html"><a href="about-the-functions.html#node-health"><i class="fa fa-check"></i><b>3.2</b> Node Health</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="about-the-functions.html"><a href="about-the-functions.html#node_channel_plots"><i class="fa fa-check"></i><b>3.2.1</b> node_channel_plots</a></li>
<li class="chapter" data-level="3.2.2" data-path="about-the-functions.html"><a href="about-the-functions.html#node_plots"><i class="fa fa-check"></i><b>3.2.2</b> node_plots</a></li>
<li class="chapter" data-level="3.2.3" data-path="about-the-functions.html"><a href="about-the-functions.html#gps_plots"><i class="fa fa-check"></i><b>3.2.3</b> gps_plots</a></li>
<li class="chapter" data-level="3.2.4" data-path="about-the-functions.html"><a href="about-the-functions.html#export_node_channel_plots"><i class="fa fa-check"></i><b>3.2.4</b> export_node_channel_plots</a></li>
<li class="chapter" data-level="3.2.5" data-path="about-the-functions.html"><a href="about-the-functions.html#export_node_plots"><i class="fa fa-check"></i><b>3.2.5</b> export_node_plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="calibration.html"><a href="calibration.html"><i class="fa fa-check"></i><b>4</b> Calibration</a>
<ul>
<li class="chapter" data-level="4.1" data-path="calibration.html"><a href="calibration.html#description"><i class="fa fa-check"></i><b>4.1</b> Description</a></li>
<li class="chapter" data-level="4.2" data-path="calibration.html"><a href="calibration.html#tag-calibration"><i class="fa fa-check"></i><b>4.2</b> Tag Calibration</a></li>
<li class="chapter" data-level="4.3" data-path="calibration.html"><a href="calibration.html#node-calibration"><i class="fa fa-check"></i><b>4.3</b> Node Calibration</a></li>
<li class="chapter" data-level="4.4" data-path="calibration.html"><a href="calibration.html#how-to-use-the-output"><i class="fa fa-check"></i><b>4.4</b> How to Use the Output</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="localization-methods.html"><a href="localization-methods.html"><i class="fa fa-check"></i><b>5</b> Localization Methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="localization-methods.html"><a href="localization-methods.html#primitive-weighted-average"><i class="fa fa-check"></i><b>5.1</b> Primitive: Weighted Average</a></li>
<li class="chapter" data-level="5.2" data-path="localization-methods.html"><a href="localization-methods.html#triangulation-functions"><i class="fa fa-check"></i><b>5.2</b> Triangulation Functions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="localization-methods.html"><a href="localization-methods.html#calibration-1"><i class="fa fa-check"></i><b>5.2.1</b> Calibration</a></li>
<li class="chapter" data-level="5.2.2" data-path="localization-methods.html"><a href="localization-methods.html#custom-distance-function"><i class="fa fa-check"></i><b>5.2.2</b> Custom Distance Function</a></li>
<li class="chapter" data-level="5.2.3" data-path="localization-methods.html"><a href="localization-methods.html#data-prep"><i class="fa fa-check"></i><b>5.2.3</b> Data Prep</a></li>
<li class="chapter" data-level="5.2.4" data-path="localization-methods.html"><a href="localization-methods.html#triangulation"><i class="fa fa-check"></i><b>5.2.4</b> Triangulation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cellular Tracking Technologies: Data Tools</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> API<a href="intro.html#intro" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="local-database-option" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Local Database Option<a href="intro.html#local-database-option" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This makes sense for a single project, so specify which of your CTT projects will be loaded into the database with the “myproject” option set to the project name on your account. (To look up your project name by station, go to “My Stations” on your account and click on the station of interest to see which project it’s affiliated with.) If you choose to create a database out of your data (fair warning: in the future, the analysis tools will be based on this structure) you will need to install PostgreSQL on your machine.<br />
<strong>Disclaimer</strong> I am providing some basic instructions for getting setup with Postgres on Windows and creating a user and database here, but please use at your own discretion and do not contact me with Postgres install questions. If any of these steps fail, seek another tutorial for installing Postgres and cross-reference with the steps here.</p>
<ol style="list-style-type: decimal">
<li>[Download and install] (<a href="https://www.postgresql.org/download/" class="uri">https://www.postgresql.org/download/</a>) for your OS<br />
</li>
<li>If pgAdmin wasn’t installed with your PostgreSQL installation, it’s a nice GUI for interacting with and visualizing your database</li>
<li>For simplicity, create a Postgres user with the same name as your computer user name. Otherwise, you will need to pass it as an argument to the connection<br />
</li>
<li>Create a database in Postgres owned by that user name. You may have to set a password, and you may have to pass that password as an argument to the connection</li>
</ol>
<ul>
<li>you may need to update your pg_hba.conf file to use the “trust” method for your connections</li>
<li>if so, you’ll also need to reload the configuration/restart Postgres for the new settings to take</li>
</ul>
<p>Creating a Postgres database through the API includes the following data checks &amp; structures:</p>
<ul>
<li>attempt to correct files missing headers</li>
<li>removal of bad time records (bounded by station deployment dates)</li>
<li>beep data
<ul>
<li>file the beep came from attached to the record</li>
<li>unique id for each beep record</li>
<li>filtering: removal of records without…
<ul>
<li>radio id</li>
<li>time stamp</li>
</ul></li>
</ul></li>
<li>node health
<ul>
<li>re-coding battery &gt; 9 to NA</li>
<li>filtering: removal of records without…
<ul>
<li>unique combination of radio id, node id, time and station id kept (i.e. removal of duplicates)</li>
<li>time stamp</li>
</ul></li>
</ul></li>
</ul>
<p>In development:</p>
<ul>
<li>salvaging corrupt rows where possible<br />
</li>
<li>tag ID validation</li>
</ul>
</div>
<div id="your-token" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Your Token<a href="intro.html#your-token" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Please request an API token through <a href="https://celltracktech.com/pages/csd-radio-api-key-request">this form</a>. The token will appear on your account page when the request is fulfilled.</p>
</div>
<div id="r-script-api_run.r" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> R script: api_run.R<a href="intro.html#r-script-api_run.r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Assign the API token you found above to the “my_token” variable</li>
<li>Set your “outpath” variable to wherever your files will live. If you have already been manually downloading files, use that as your “outpath.”</li>
</ol>
<ul>
<li>The script will search that directory, and will only download files you haven’t already downloaded.</li>
<li>It will create a nested folder structure within that directory in the following order: project name, station(s), file types, files</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>If you do not want to create a database…</li>
</ol>
<ul>
<li>do not set the “conn” variable</li>
<li>remove the “conn” argument from the get_my_data() function</li>
<li>do not run update_db()</li>
<li>comment out the dbDisconnect() line</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>If you do want to create a database locally, set “db_name” to the name of the Postgres database you created</li>
</ol>
<p>An example script using the API tools to download files:</p>
<pre><code>library(celltracktech)
library(DBI)
start &lt;- Sys.time()

####SETTINGS#####
my_token &lt;- &quot;your token here&quot;
db_name &lt;- &quot;mydb&quot;
myproject &lt;- &quot;CTT Project Name&quot; #this is your project name on your CTT account
conn &lt;- dbConnect(RPostgres::Postgres(), dbname=db_name)
################
outpath &lt;- &quot;~/Documents/data/radio_projects/myproject&quot; #where your downloaded files are to go
get_my_data(my_token, &quot;~/Documents/data/radio_projects/myproject&quot;, conn, myproject=myproject)
update_db(conn, outpath, myproject)
dbDisconnect(conn)

#findfiles(outpath, &quot;directory path where you want your caught files to go&quot;)

time_elapse &lt;- Sys.time() - start
print(time_elapse)</code></pre>
</div>
<div id="terminal" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Terminal<a href="intro.html#terminal" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Run “Rscript &lt;path to your copy of api_run.R&gt;” on the command line to run the script outside of RStudio (recommended)</p>
</div>
<div id="data-cleaning" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Data Cleaning<a href="intro.html#data-cleaning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To remove duplicate records from your database (more than one record that has the same time stamp of a tag ID “beeping” on a node) the <code>db_cleanup()</code> function may be used. Additionally, if there are erroneous records of the same time stamp, tag ID and node ID with varying RSSI values, all records for that “beep” (combination of timestamp, tag ID and node ID) will be removed.</p>
</div>
<div id="incorporating-node-data-into-your-database" class="section level2 hasAnchor" number="1.6">
<h2><span class="header-section-number">1.6</span> Incorporating Node Data Into Your Database<a href="intro.html#incorporating-node-data-into-your-database" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To include data pulled from your node SD card(s) create a folder called “nodes” and populate it with folders named for each node. Place the data pulled from each node in its respective folder. If you have already pulled sensor station data via the API, place the “nodes” folder in the folder that is auto-created by <code>get_my_data()</code> named for your project. In this case, the “outpath” and “myproject” arguments remain the same as for the functions above. In absence of a project name, “outpath” will be the folder containing the “nodes” folder. Run <code>import_node_data(conn, outpath, myproject="your project name")</code> to read in your node data and add it to the database such that it will not duplicate sensor station data.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tools-to-work-with-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-intro.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
